---
title: 'Capillary state capacity: Programmatic mayors and bureaucratic quality in the municipalities of Brazil'
author: 
- Galileu Kim^[Department of Politics, Princeton University]
abstract: This paper represents a first step in a larger research project on local state capacity and public goods delivery. It focuses on a particular dimension of state capacity, namely, its administrative capacity. Because of decentralization, municipal-level bureaucrats have increased in size and importance. However, this growing sector in the administrative structure of the developing countries across Latin America remains relatively unexplored. Building on a micro-level data set of municipal-level bureaucrats in Brazil from 1998 to 2015, the paper describes inter-municipal and inter-temporal variation in a key outcome of interest, the educational levels of bureaucrats in the executive branches of Brazilian municipalities. It then proposes an identification strategy for estimating the effect of partisanship on the staffing decisions made by mayors.
documentclass: article
output: 
  pdf_document:
geometry: margin=1.5in
fontsize: 11pt
bibliography: mybibfile.bib
fig_width: 3
fig_height: 3
header-includes:
  - \linespread{1.5}
---
```{r, include=FALSE, cache = T}
lapply(c("data.table", 
         "ggplot2",
         "doParallel",
         "foreach", 
         "parallel", 
         "dplyr",
         "readr",
         "maptools",
         "tidyr",
         "rgeos", 
         "rgdal",
         "maptools",
         "ggmap",
         "scales",
         "electionsBR",
         "doParallel", 
         "xtable"), require, quietly = T, character.only = T)
path <- "C:/Users/galil/Google Drive/Princeton/Dissertation/Database/Database Municipios Brazil/RAIS/"
set.seed(1789)

# Repositories
states <- c("AC", "AL", "AM", "AP", "BA", "CE", "DF", "ES", "GO",
            "MA", "MG", "MS", "MT", "PA", "PB", "PE", "PI", "PR",
            "RJ", "RN", "RO", "RR", "RS", "SC", "SE", "SP", "TO")
years <- 1998:2015
```

```{r, include = F, cache = T}
## Loading data: RAIS

rais.mun <- read_csv("C:/Users/Galileu Kim/Google Drive/Princeton/R/RAIS/microdados/consolidado/rais_mun.csv")

## Loading data: TSE

cl <- makeCluster(3)
registerDoParallel(cl)
mun.elec <- foreach(i = seq(2000,2012, by = 4), .packages = c("dplyr", "readr")) %dopar% {
  read_csv(file = paste0("C:/Users/Galileu Kim/Google Drive/Princeton/R/TSE/elec_",i,".csv")) %>%
    filter(DESCRICAO_CARGO == "PREFEITO", DESC_SIT_CAND_TOT == "ELEITO") %>%
    arrange(CODIGO_MUNICIPIO) %>%
    group_by(CODIGO_MUNICIPIO) %>%
    filter(row_number() == 1) %>%
    select(ANO_ELEICAO, SIGLA_UF, CODIGO_MUNICIPIO, SIGLA_PARTIDO, NOME_MUNICIPIO) %>%
    rename(year = ANO_ELEICAO, state = SIGLA_UF, tse_code = CODIGO_MUNICIPIO, party = SIGLA_PARTIDO, mun_name = NOME_MUNICIPIO)
} %>% bind_rows()
stopCluster(cl)
rm(cl)

## Harmonizing datasets: TSE and IBGE
rais.mun <- read_csv(file = "C:/Users/Galileu Kim/Google Drive/Princeton/Dissertation/Database/Database Municipios Brazil/TSE/mun_id_br.csv") %>%
  select(tse_code, ibge6_code) %>%
  rename(mun_id = ibge6_code) %>%
  inner_join(., mun.elec, by = "tse_code") %>%
  ungroup %>%
  select(., -tse_code) %>%
  group_by(mun_id) %>%
  select(mun_id, year, party) %>%
  mutate(party = as.factor(party)) %>%
  spread(year, party) %>% #transforming to wide form
  setNames(c('mun_id', 'party.2000', 'party.2004', 'party.2008', 'party.2012')) %>%
  inner_join(., rais.mun, by = "mun_id")

## Merging RAIS dataset with the PNUD dataset:
pnud.mun.2000 <- 
  read_csv(file = "C:/Users/Galileu Kim/Google Drive/Princeton/R/Censo/censo_pnud_eng.csv") %>%
  filter (year == 2000) %>%
  left_join(filter(rais.mun, year == 2000), ., by = "mun_id")

## Obtaining budgetary expenses
receita <- read.csv("C:/Users/Galileu Kim/Google Drive/Princeton/Dissertation/Database/Database Municipios Brazil/FINBRA/receita/receita_2000.csv")

tax.2000 <- receita %>%
  select(state = ?..CD_UF, cdmun = CD_MUN, taxes = Impostos)

## Harmonizing with the IBGE Code:

tax.2000 <- 
  read_csv(file = "C:/Users/Galileu Kim/Google Drive/Princeton/Dissertation/Database/Database Municipios Brazil/FINBRA/codigos/cod_ibge_2000.csv") %>%
  mutate(state = CdUF, cdmun = CdMun) %>%
  inner_join(., tax.2000, by = c("state", "cdmun")) %>%
  select(mun_id, taxes)
rm(receita)
```

#Introduction

This paper represents an initial exploration of state capacity at the municipal level in Brazil from 1998 to 2015. It focuses on one of its dimension: administrative capacity. Building on an annual dataset from the Ministry of Labor, I explore patterns in the data and highlight recent trends in the educational level of municipal bureaucrats in Brazil. I then propose an identification strategy for estimating the effect of programmatic mayors on administrative capacity.

#Literature Review: State Capacity

State capacity has been the subject of extensive research, especially in the context of the developing world. Scholars have linked it to certain outcomes such as economic development [^1] , the successful creation of a developmental state[^2] and democratic stability [^3]. These different works have converged in the importance of state capacity, but in doing so have emphasized different dimensions of the concept.[^3]

Some scholars analyzed the extractive capacity of the state: whether it is able to exact financial contributions from its citizens.[^4] Others have focused on administrative capacity, analyzing the role of bureaucratic professionalization and autonomy in explaining the successful implementation of developmental projects and the rise of the developmental state.[^5] This paper explores the latter dimension, administrative capacity, by measuring the average level of education of municipal bureaucrats in Brazil.

To demonstrate the intuition of a multidimensional state capacity, we see that the educational level of the bureaucrats and taxes per capita at the municipal level seem to be correlated. Fitting a 3rd degree polynomial to the data, we see a clear upward trend in the more densely populated area from 2.5 to 7.5:

```{r, echo=FALSE, cache=T, fig.width=5, fig.height=3, fig.align='center',  dpi = 300, warning= F, message = F}
plot <- pnud.mun.2000 %>%
  inner_join(., tax.2000, by = "mun_id") %>%
  mutate(tax_pcp = taxes/pop_tot) %>%
  select(mun_id, mean.edu, mean.wage, tax_pcp)

ggplot(data = plot, aes(mean.edu, tax_pcp)) +
  geom_point(color = "steelblue", alpha = 0.2, shape = 21, color = "black", size = 2) +
  scale_y_continuous(limits = c(0,100)) +
  geom_smooth(method="loess",se=TRUE)
```


Why educational levels? One could argue that the educational level of a bureaucrat does not necessarily translate to a higher level of administrative capacity. Yet, in the context of Brazilian municipalities, it is worth noting that the educational level of bureaucrats span from those who have not even finished lower school to the few who have finished their higher education, as the following histogram illustrates. It is constructed by averaging the levels of education of municipal bureaucrats.

```{r, echo=FALSE, cache=T, fig.width=5, fig.height=3, fig.align='center',  dpi = 300}
ggplot(data = filter(rais.mun, year == 2000), aes(x = mean.edu)) +
  geom_histogram(aes(fill = ..count..), binwidth = 0.1) +
  ggtitle("Histogram of municipal bureaucrat's \n educational levels (2000)") +
  xlab("Average education level") + ylab("Frequency")
```

Educational level is measured in a scale from 1 to 9, each categorical value denoting as follows:

```{r, echo=FALSE, results = 'asis', cache=F}
a <- seq(1,9,1)
b <- c("Illiterate",
       "Lower School Incomplete",
       "Lower School Complete",
       "Middle School Incomplete",
       "Middle School Complete",
       "High School Incomplete",
       "High School Complete",
       "Higher Education Incomplete",
       "Higher Education Complete")
data <- as.data.frame(a,b) 
print(xtable::xtable(data, caption = "Levels of Education"), comment=F)
rm(a,b,data)
```

While educational level is not a perfect measure, it is reasonable to claim that municipalities staffed by bureaucrats who have been unable to finish lower school are probably less capable than those staffed by college-educated bureaucrats. As pointed out by Fukuyama (2013):	"Beyond taxation, another critical measure of [state] capacity is the level of education and professionalization of government officials."[^6] Other variables could play a role in the administrative capacity of these municipalities: work experience, type of contract offered, wages, data which I was able to gather and process. These will be explored in subsequent research.

A further benefit from measuring educational levels is that it allows quantifying administrative capacity in an objective manner. It is a measure that does not rely on expert surveys[^8], such as the World Governance Indicators constructed by the World Bank. The study follows a similar research strategy as Bersch et al. (2015), who analyze different bureaucracies in Brazilian federal agencies and identify "islands of excellence" precisely by measuring educational levels, types of contracts and partisanship of agency directors.

#Motivation:

Yet the question remains: why should we look at these municipal bureaucrats? Indeed, most of the scholarly literature has focused on national bureaucracies with little discussion of subnational bureaucracies. This is hardly surprising. From the 1930s to the 1970s, several Latin American countries had sought to implement Import-Substitution Industrialization (ISI) as a strategy to develop economically.[^9] In doing so, policymakers formulated and implemented economic policy through a national bureaucracy, usually the Ministry of Finance and a Central Bank. Centralization of power under military rule further marginalized municipalities from power.

It was an era characterized by the pursuit of industrialization and the preeminence of an alliance between technocrats and military rulers.[^10] Brazil was no exception to these regional trends.[^10] Within that context, it would make little sense to analyze municipal bureaucracies, when most (if not all) of political action took place at the national level. Decentralization, however, would change that.

Since the enactment of the Constitution of 1988 in Brazil, responsibility for implementation of different public policies (health provision, education) has been devolved to municipalities.[^11] As a proportion of the national bureaucracy - federal, state, and municipal - the latter has increased in size and importance since the 1990s. In fact, since 1998, municipal bureaucracies have surpassed state-level bureaucracies in number of employees.

```{r, echo = F, cache = T, fig.width=5, fig.height=3, fig.align='center',  dpi = 300}
# Plot for bureaucracy at different levels of gov't
year <- c(1992, 1995, 1997, 1998, 1999, 2002, 2003, 2004, 2006, 2007, 
          1992, 1995, 1997, 1998, 1999, 2002, 2003, 2004, 2006, 2007,
          1992, 1995, 1997, 1998, 1999, 2002, 2003, 2004, 2006, 2007)
perc <- c(round(2666/7505*100, 2), round(2958/7843*100, 2), round(3030/7700*100, 2), 
       round(3228/7949*100, 2), round(3333/7927*100, 2),  47.62, 47.91, 49.54, 49.16, 50.67,
       3362/7595*100, 3442/7843*100, 3274/7700*100, 3177/7949*100, 3154/7927*100, 37.9,
       37.4, 36, 35.7, 34.1, 1477/7595*100, 1443/7843*100, 1396/7700*100, 1544/7949*100, 1440/7927*100, 14.5,
         14.7, 14.5, 15.1, 15.2)
level <- c(rep("mun", 10), rep("state", 10), rep("fed", 10))

data <- as.data.frame(cbind(year, perc, level))
data$perc <- data$perc %>% as.character %>% as.double
data$level <- factor(data$level, levels = c("fed", "state", "mun"), labels = c("Federal", "State", "Municipal"))
                      
rm(year, perc, level)

ggplot (data, aes(x = year, y = perc, group = level)) + geom_line(aes(color = level), size = 1) +
 scale_y_continuous(name = "Percentage", breaks = seq(10,60, 10)) + xlab("Year") +
  ggtitle('Proportion of bureaucrats \n by sphere of government (1992 - 2007)')
```

Furthermore, several countries in Latin America are marked by large within-country heterogeneities. O'Donnell emphasizes that within Latin American countries, there may be 'green areas' with high state capacity (S?o Paulo) and large 'brown areas' in which it is lower (the Northeast, Amazon).[^12] In countries characterized by large socioeconomic inequalities, it should not be surprising that there are wide inequalities in the distribution of state capacity.[^13] Analyzing municipal-level bureaucracies sheds light on these within-country variations in administrative capacity, as the following map illustrates:

```{r, echo = F, cache = T, fig.width=9, fig.height=7, fig.align='center', warning = F, dpi = 300, message= F}
## Making map
map.mun <- readOGR(dsn = "C:/Users/Galileu Kim/Google Drive/ArcGIS/Brazil", layer = "mun_2000_br", 
                   verbose = F)
proj4string(map.mun) <- CRS("+init=epsg:31983") #Change projection to SIRGAS 2000

# Modifying names
map.mun@data <- map.mun@data %>%
  mutate(NOME = NOME %>% as.character %>% toupper, id = row.names(map.mun))

## Converting map to ggplot
map.mun <- fortify(map.mun) %>%
  left_join(., map.mun@data, by = "id") %>%
  select(long, lat, group, CODIGO, NOME) %>%
  rename(mun_id = CODIGO) %>%
  mutate(mun_id = mun_id %>% as.character %>% as.integer)

# Joining with RAIS
# Obtaining wide-form edu
rais.edu <- rais.mun %>% 
  group_by(mun_id) %>% 
  select(mun_id, year, mean.edu) %>% 
  spread(year, mean.edu) %>%
  setNames(c('mun_id', paste0('edu_', 1998:2015)))

map.edu <- map.mun %>%
  left_join(., rais.edu, by = "mun_id")

ggplot() +
  geom_polygon(data = map.edu, aes(x = long, y = lat, group = group, fill = edu_2000),
               color = NA) +
  scale_fill_distiller(palette = "RdBu",
                       breaks = pretty_breaks(n = 8)) +
  guides(fill = guide_legend(reverse = T)) +
  labs (fill = "Edu") +
  theme_nothing(legend = TRUE) +
  xlim(range(map.edu$long)) + ylim(range(map.edu$lat)) +
  coord_map() +
  ggtitle("Bureaucratic educational levels: \n municipal average (2000)")
```
The following map highlights the within-country heterogeneity of administrative capacity in Brazil in the year 2000. Colors range from blue (low) to red (high), representing average levels of education for municipal bureaucrats. The scale ranges from 1 (Lower School Incomplete) to 9 (Higher Education complete). The map demonstrates the spatial unevenness of educational levels for bureaucrats: the Southeast and South, historically the most developed regions of Brazil, also possess on average the most educated bureaucrats. In the Northeast, a region characterized by a semi-arid climate and widespread poverty, the converse seems to hold.

But even within regions, within states, there is significant variation. Take, for instance, the state of S?o Paulo, a state responsible for over one third of Brazil's GDP and the most developed in socioeconomic terms. There is large variation in the average educational level of bureaucrats across municipalities, even those relatively close to the state capital, S?o Paulo, located in the southeast corner of the map.

```{r, echo = F, cache = T, fig.width=9, fig.height=7, fig.align='center', warning = F, dpi = 300, message= F}
map.edu.sp <- map.edu %>%
  left_join(., rais.mun %>% 
              filter(year == 2012) %>% 
              select(mun_id, state), by = "mun_id") %>%
  filter(state == 'SP')
  
ggplot() +
  geom_polygon(data = map.edu.sp, aes(x = long, y = lat, group = group, fill = edu_2000),
               color = "white", size = 0.1) +
  scale_fill_distiller(palette = "RdBu",
                       breaks = pretty_breaks(n = 8)) +
  guides(fill = guide_legend(reverse = T)) +
  labs (fill = "Edu") +
  theme_nothing(legend = TRUE) +
  xlim(range(map.edu.sp$long)) + ylim(range(map.edu.sp$lat)) +
  coord_map() +
  ggtitle("Bureaucratic educational levels: S?o Paulo (2000)")
```

Finally, administrative capacity at the local level is correlated with a set of social welfare indicators - life expectancy, literacy rates, and, more broadly, the human development index (HDI) - suggesting that administrative capacity and societal welfare are indeed related.

```{r, echo = F, cache = T, fig.width=5, fig.height=3, fig.align='center', warning = F, dpi = 300, message= F}
pnud.mun.2000 <- 
  read_csv(file = "C:/Users/Galileu Kim/Google Drive/Princeton/R/Censo/censo_pnud_eng.csv") %>%
  filter (year == 2000) %>%
  left_join(filter(rais.mun, year == 2000), ., by = "mun_id")

ggplot(data = pnud.mun.2000, aes(x = mean.edu, y = IDHM)) + 
    geom_point(alpha = 0.5, color = "lightskyblue3") + geom_smooth(method=lm) + xlab('Bureaucratic Average Educational Level') + ylab('Municipal Human Development Index')

ggplot(data = pnud.mun.2000, aes(x = mean.edu, y = life_exp)) + 
    geom_point(alpha = 0.5, color = "lightskyblue3") + geom_smooth(method=lm) + xlab('Bureaucratic Average Educational Level') + ylab('Life Expectancy')

ggplot(data = pnud.mun.2000, aes(x = mean.edu, y = 100 - perc_illit_15)) + 
    geom_point(alpha = 0.5, color = "lightskyblue3") + geom_smooth(method=lm) + xlab('Bureaucratic Average Educational Level') + ylab('Literacy Rates')
```

#Data
I have collected the data for this research project from a variety of sources. I will outline them according to the specific variable of interest:

1. Educational level of individual bureaucrat: Relat?rio Anual de Informa??es Sociais (RAIS), Brazilian Ministry of Labor.
2. Socioeconomic indicators (population, educational level, GDP): Instituto Brasileiro de Geografia e Estat?sticas (IBGE) and United Nations Development Program (UNDP).
3. Mayor characteristics, electoral results: Tribunal Superior Eleitoral (TSE)

What is novel about this paper is the use of the Annual Report on Social Information (RAIS), a micro-level data set containing individual level variables for employees in the formal sector, as well as employer-level characteristics (nature of activities, number of employees, geographical location). As the name implies, it is collected annually by the Ministry of Labor and while self-reported, it has been implemented since the late 1970's with adjustments in its methodology to reduce measurement error. Because of its importance for administrative decisions, is corrected by ministry, with financial sanctions imposed if misreporting is identified.

This data set has been used in economic research on labor markets and industrial production in Brazil.[^14] However, the richness of this data has not been exploited by political scientists. A short description of its structure: each row is an individual employee, and each column characterizes a particular variable. These include the average annual wage, the type of admission, type of contract, education level, amount of time spent in the current position, among others. There is a variety of questions that can be asked with this data, but for this paper I will focus on one: professionalization of bureaucracy, measured as the average level of education of bureaucrats in the municipality.

I have available data from 1998-2015. Because the RAIS contains the universe of formally employed workers in Brazil, each year over 30 million observations are generated. As an initial exploration, I have subsetted the data to those workers formally employed by the local municipality. Furthermore, I have filtered the workers who are part of the administrative staff: their job description includes auxiliary administrative staff or administrative director. As a result of this initial filter, there are over two million municipal bureaucrats observed for each year in Brazil, with a clear upward trend in the past twenty years.

```{r, echo = F, cache = T, fig.width=5, fig.height=3, fig.align='center', warning = F, dpi = 300, message= F}
total <- rais.mun %>%
  group_by(year) %>%
  summarise(n = sum(total))

ggplot (total, aes(x = year, y = n/1000)) + geom_line(aes(color = n), size = 1) + xlab("Year") +
  ylab ("Number of municipal bureaucrats \n (thousands)") + 
  ggtitle('Number of municipal bureaucrats (1992-2007)') + guides(color = F)
```
There are additional tests I need to run on the dataset to detect measurement errors. Research on the RAIS data conducted by the Applied Economics Research Institute (IPEA), a governmental think tank, highlight important limitations in the reliability of the data, especially for the case of poorer municipalities with low levels of education.[^15] Unfortunately, the alternative source of information, the National Household Survey (PNAD) administered by the IBGE, only covers 800 out of the 5500 municipalities. Only after 2012 does it expand its sample to 3000 municipalities.

The next step in the data collection process will be a more rigorous comparison between alternative databases (PNAD, RAIS, and the Census) to verify the reliability of the RAIS dataset and triangulate it.

#Research Design: Mayor Partisanship and Differences-in-Differences Estimation

#Mayor Partisanship
To cite Evans, Rueschemeyer and Skocpol (1985), in order to understand the drivers of bureaucratic professionalization at the local level it is necessary to bring the state back in. In our present discussion, a particular set of political actors: mayors. There is still limited exploration of what drives elected officials to invest in changes in the bureaucracy. Scholars working on the American context have emphasized the role of intellectual leaders and social movements. A major actor in this push National Civil Service Reform League, which successfully pushed for public sector reforms with the Peddleton Act in 1883.[^16]

Grindle's (2012) seminal work _'Jobs for the Boys'_ presents a set of case studies on Latin American countries, tracing the political origins of public sector reforms as well as the consequences of patronage on bureaucratic professionalism. Contrary to the widespread view that political discretion over the appointment of bureaucrats contributes to the oft lamented state of public sectors in Latin America, Grindle argues that patronage is not necessarily inconsistent with improvements in bureaucratic professionalization. Rather, what is important is the "political decision" by the politician on who to hire into the bureaucracy.

This intellectual exercise posited by Grindle marks a departure from the career-service, depoloticized bureaucracy described in Weber's typology. It is paramount to understand under what conditions mayors decide to hire more educated bureaucrats as part of their staff. Such a research question would explore politicians' motivations behind investing in the greater professionalization of bureaucracy and what parameters affect this decision. O'Donnell (1973) highlights the importance of ideological commitments to developmentalism by within the government to push forth the professionalization of the state in the context of bureaucratic authoritarianism in Latin America.

Mayors in Brazil enjoy complete autonomy over hiring decisions for their executive branch. There are no federal agencies or state agencies directly responsible for staffing municipalities. Because we are focusing on mayors, a possible candidate for operationalizing these ideological commitments is the partisanship of the mayor. We can think of partisanship in our context as a parameter capturing the ideological preferences of the individual politicians, who self-select into these organizations which have an ideological position (or lack thereof). 

In the Brazilian context, there are two parties which stand in diametrically opposite poles of the ideological spectrum. The Labor Party (PT) was characterized in the early 2000's by a high degree of ideological coherence of its politicians, as well as a deep seated commitment to public goods delivery and programmatic policy. The Brazilian Democratic Movement Party (PMDB) is as vague in ideological content as its name suggests: it is characterized by an emphasis on patronage which may be detrimental in the hiring of educated bureaucrats. Previous research, however, has not found significant differences in behavior between mayors from PT in Brazil.[^17] This study marks a further exploration of this question.

#Identification Strategy: generalized Differences-in-Differences

To frame it in the causal inference framework, the treatment is a mayor with an ideological commitment to programmatic policies at a local level: i.e. a PT mayor. This should translate into an investment in the hiring of highly-skilled local level bureaucrats to ensure that these policies are actually enacted.  The control group does not receive that treatment, and in order to ensure a clear identification of the causal effect, I use as a baseline the most clientelistic party: the PMDB. The control group is thus the one that elects a PMDB mayor.

The question is then how we are to estimate this causal effect. Because I am interested in changes within the administration of the mayor, a Differences-in-Differences estimation seems to be the most appropriate analysis. This would permit leveraging the information provided by the cross-sectional and longitudinal data which I have collected. The treatment group are municipalities which have elected a PT mayor but did not elect one for the previous term. The control group would be all municipalities which have not elected a PT mayor for a given term. 

The PT has been able to win electorally the following municipalities. As demonstrated visually below,the PT has won municipalities which are scattered throughout Brazil and do not show a clear spatial clustering.

```{r, echo = F, cache = T, fig.width=7, fig.height=4, fig.align='center', warning = F, dpi = 300, message= F}
## Loading data: TSE
cl <- makeCluster(3)
registerDoParallel(cl)
mun.elec <- foreach(i = seq(2000,2012, by = 4), .packages = c("dplyr", "readr")) %dopar% {
  read_csv(file = paste0("C:/Users/Galileu Kim/Google Drive/Princeton/R/TSE/elec_",i,".csv")) %>%
    filter(DESCRICAO_CARGO == "PREFEITO", DESC_SIT_CAND_TOT == "ELEITO") %>%
    arrange(CODIGO_MUNICIPIO) %>%
    group_by(CODIGO_MUNICIPIO) %>%
    filter(row_number() == 1) %>%
    select(ANO_ELEICAO, SIGLA_UF, CODIGO_MUNICIPIO, SIGLA_PARTIDO, NOME_MUNICIPIO) %>%
    rename(year = ANO_ELEICAO, state = SIGLA_UF, tse_code = CODIGO_MUNICIPIO, party = SIGLA_PARTIDO, mun_name = NOME_MUNICIPIO)
} %>% bind_rows()
stopCluster(cl)
rm(cl)

## Harmonizing municipal identifiers: TSE and IBGE
map.elec <- read_csv(file = "C:/Users/Galileu Kim/Google Drive/Princeton/Dissertation/Database/Database Municipios Brazil/TSE/mun_id_br.csv") %>%
  select(tse_code, ibge6_code) %>%
  rename(mun_id = ibge6_code) %>%
  inner_join(., mun.elec, by = "tse_code") %>%
  ungroup %>%
  select(., -tse_code) %>%
  group_by(mun_id) %>%
  select(mun_id, year, party) %>%
  mutate(party = as.factor(party)) %>%
  spread(year, party) %>% #transforming to wide form
  setNames(c('mun_id', 'party.2000', 'party.2004', 'party.2008', 'party.2012')) %>%
  right_join(., map.mun, by = "mun_id")

##Plotting
ggplot() +
  geom_polygon(data = map.elec, aes(x = long, y = lat, group = group),
               color = NA, size = 0.1,  alpha = 0.2) +
  geom_polygon(data = filter(map.elec, party.2000 == "PT"), 
               aes(x = long, y = lat, group = group, fill = "PT", color = "red"),
               color = NA, size = 0.1) +
  labs (fill = "Party") +
  theme(legend.key.size = unit(2, "cm"), legend.text = element_text(size = 20)) +
  theme_nothing(legend = TRUE) +
  xlim(range(map.elec$long)) + ylim(range(map.elec$lat)) +
  coord_map() + 
  ggtitle("Municipalities won by PT: 2000")

ggplot() +
  geom_polygon(data = map.elec, aes(x = long, y = lat, group = group),
               color = NA, size = 0.1,  alpha = 0.2) +
  geom_polygon(data = filter(map.elec, party.2004 == "PT"), 
               aes(x = long, y = lat, group = group, fill = "PT", color = "red"),
               color = NA, size = 0.1) +
  labs (fill = "Party") +
  theme(legend.key.size = unit(2, "cm"), legend.text = element_text(size = 20)) +
  theme_nothing(legend = TRUE) +
  xlim(range(map.elec$long)) + ylim(range(map.elec$lat)) +
  coord_map() + 
  ggtitle("Municipalities won by PT: 2004")

ggplot() +
  geom_polygon(data = map.elec, aes(x = long, y = lat, group = group),
               color = NA, size = 0.1,  alpha = 0.2) +
  geom_polygon(data = filter(map.elec, party.2008 == "PT"), 
               aes(x = long, y = lat, group = group, fill = "PT", color = "red"),
               color = NA, size = 0.1) +
  labs (fill = "Party") +
  theme(legend.key.size = unit(2, "cm"), legend.text = element_text(size = 20)) +
  theme_nothing(legend = TRUE) +
  xlim(range(map.elec$long)) + ylim(range(map.elec$lat)) +
  coord_map() + 
  ggtitle("Municipalities won by PT: 2008")

ggplot() +
  geom_polygon(data = map.elec, aes(x = long, y = lat, group = group),
               color = NA, size = 0.1,  alpha = 0.2) +
  geom_polygon(data = filter(map.elec, party.2012 == "PT"), 
               aes(x = long, y = lat, group = group, fill = "PT", color = "red"),
               color = NA, size = 0.1) +
  labs (fill = "Party") +
  theme(legend.key.size = unit(2, "cm"), legend.text = element_text(size = 20)) +
  theme_nothing(legend = TRUE) +
  xlim(range(map.elec$long)) + ylim(range(map.elec$lat)) +
  coord_map() + 
  ggtitle("Municipalities won by PT: 2012")
```

The following heatmap further illustrates the motivation for this paper. It is a mapping of a reduced sample (5%) of the universe of municipalities. Each row corresponds to an individual municipality, and each column to a particular year from 2000 to 2015. The color red indicates a municipality-year in which a mayor from PT was in office. Blue indicates a non-mayor PT.

```{r, echo=FALSE, message = F}
require(readr)
require(dplyr)
require(foreach)
require(ggplot2)
elec <- read_csv(file = "C:/Users/Galileu Kim/Google Drive/Princeton/Dissertation/Database/Database Municipios Brazil/TSE/mun_id_br.csv") %>%
  select(tse_code, ibge6_code) %>%
  rename(mun_id = ibge6_code) %>%
  inner_join(., mun.elec, by = "tse_code") %>%
  select(-tse_code) %>%
  select(mun_id, year, party) %>%
  mutate(party = as.character(party)) %>%
  mutate(treat = ifelse(party == "PT", 1, 0)) %>% #Creating column treatment
  group_by(mun_id) %>%
  arrange(mun_id, year)

elec <- foreach(i=1:5, .combine = rbind) %do%{
  seq <- seq(2000, 2012, by = 4)
  temp <- slice(elec, i)
  temp <- bind_rows(temp,
                    temp %>% mutate(year = seq[i] + 1),
                    temp %>% mutate(year = seq[i] + 2),
                    temp %>% mutate(year = seq[i] + 3))
}
rm(temp,i)

##Joining RAIS and TSE
data.mun <- inner_join(rais.mun, elec, by = c('year', 'mun_id')) %>%
  ungroup
rm(elec)

pt.pmdb <- data.mun %>% 
  mutate(mun_id = as.factor(mun_id)) %>%
  group_by(mun_id) %>% 
  filter(all(party %in% c("PT", "PMDB"))) %>% 
  arrange(mun_id)

ggplot(data = pt.pmdb, aes(x = year, y = mun_id), colour = "white") +
  geom_tile(aes(fill = treat), color = "white", size = 0.1) +
  scale_fill_gradient(low = "steelblue", high = "red3",
                      guide = guide_legend(title = 'Partisanship'),
                      breaks = c(1,0), labels = c("PT", "PMDB")) +
  theme_light(base_size = 9) +
  xlab("Municipalities") + ylab("Year") +
  labs(x = "", y = "") + theme(axis.text.y = element_blank(),
                               axis.ticks.y = element_blank(),
                               panel.grid.major = element_line(colour = "white"))
```

#Random Forest
If my hypothesis about the ideological commitment of PT mayors is correct, we should observe a causal effect of a PT mayor-year on the average level of education of the bureaucrats in municipalities. In order to assess the plausibility of this hypothesis, I run a random forest with my dataset in order to find the more informative covariates. 

```{r, echo=F, message=F, warning=FALSE, cache=T}
require("causalTree")
require("randomForest")

## Prepping data
data.rf <- pnud.mun.2000 %>%
  ungroup %>%
  inner_join(., tax.2000, by = "mun_id") %>%
  mutate(tax_pcp = taxes/pop_tot) %>%
  select(-mun_id, -state, -year.y, -year.x, -uf, -name, -taxes) %>%
  mutate(party.2000 = as.character(party.2000),
         party.2004 = as.character(party.2000),
         party.2008 = as.character(party.2000),
         party.2012 = as.character(party.2000)) %>%
  mutate(treat.2000 = ifelse(party.2000 == "PT", 1, 0),
         treat.2004 = ifelse(party.2004 == "PT", 1, 0),
         treat.2008 = ifelse(party.2008 == "PT", 1, 0),
         treat.2012 = ifelse(party.2012 == "PT", 1, 0)) %>%
  select(-party.2000, -party.2004, -party.2008, -party.2012,
         -perc_garbage, -perc_sanit, -contains("IDHM")) %>%
  na.omit

##Estimating random forest
rf <- randomForest(mean.edu ~ ., data = data.rf,
                   importance = T, do.trace = 100, ntree = 500)
varimp <- varImpPlot(rf)

#Plotting % change in MSE
rf.plot <- varimp %>%
    as.data.frame %>% 
    mutate(names = rownames(varimp))
colnames(rf.plot)[1] <- "MSE"
rf.plot <- rf.plot %>% 
  arrange(., desc(MSE))

ggplot(data = rf.plot, aes(x = MSE, y = reorder(names, MSE))) +
  scale_fill_discrete(guide = guide_legend(reverse = T)) +
  geom_point(color = "steelblue", alpha = 0.4) +
  ylab("Variable") +
  xlab("Change in MSE")
rm(varimp, rf)
```

It is clear that although non-zero, partisanship (treat.2000-12) does not seem to be particularly informative for the outcome of interest. Interestingly, the average age of bureaucrats (age) and their average wage (mean.wage) are the most informative predictors of education levels. This is not necessarily surprising, given that due to improvements in the national educational system, older bureaucrats will tend to be less educated. The relationship between wages and educational levels is trivial, though it would suggest that there is some premium associated with education in the public sector, including at the municipal level.

#Causal Forest
This exercise was done with the goal of identifying which predictors to include in the causal forest outlined by Athey et al. (2016).:

```{r, eval=FALSE, include=FALSE}
## Creating training and testing datasets
data.rf$id <- 1:nrow(data.rf)
train.cf <- data.rf %>%
  sample_frac(0.5)
test.cf <- anti_join(data.rf, train.cf, by = 'id')

## Running the honest tree
honest.tree <- honest.causalTree(mean.edu ~ age + mean.wage + perc_illit_15 + perc_med +
                                   perc_formal + pop_urb + mean.time_job,
                                 data = train.cf, treatment = train.cf$treat.2004,
                                 est_data = test.cf, est_treatment = test.cf$treat.2004,
                                 split.Rule = "CT", split.Honest = T, 
                                 HonestSampleSize = nrow(test.cf), split.Bucket = T,
                                 cv.option = "fit", cv.Honest = F)
```

Unfortunately, I did not have enough time to run the algorithm - it runs for quite a while - but the intuitive appeal of the idea is clear. By constructing conditional ignorability within each leaf by randomly splitting of covariates, the estimation of the treatment should be attractive. However, I do not quite see how is it possible to incorporate temporal dynamics to this kind of nonparametric estimation. 

#Generalized Diff-in-Diff
We now turn to the generalized differences-in-differences estimation outlined in Imai and Kim (2016). What we will estimate is the effect of a transition into a programmatic party from the onset of the treatment (election of a PT mayor) up to 3 years into the administration. I obtain the confidence intervals from the estimates through bootstrap.

```{r, cache = T, echo = F}
##Subsetting data
rais.mun.did <- as.data.table(data.mun) %>%
  .[, .(mun_id, year,  dem = treat, dv.0 = mean.edu)]

##Indicator for transition to programmatic at time t
rais.mun.did <- rais.mun.did[, `:=` (lag.dem = shift(dem, 1, type = "lag")), by = mun_id]
rais.mun.did <- rais.mun.did[, `:=` (index.lag = dem - lag.dem)]

##Future variables for growth rate
rais.mun.did <- rais.mun.did[, `:=` (dv.1 = shift(dv.0, 1, type = 'lead'), dv.2 = shift(dv.0, 2, type = 'lead'),
                   dv.3 = shift(dv.0, 3, type = 'lead'), dv.4 = shift(dv.0, 4, type = 'lead'),
                   dv.5 = shift(dv.0, 5, type = 'lead'), dv.6 = shift(dv.0, 6, type = 'lead'))]

##Computing the average growth rate for non-treated at time t
y.0 <- rais.mun.did[index.lag == 0, .(y.0 = mean(dv.0, na.rm = T)), by = year]
y.1 <- rais.mun.did[index.lag == 0, .(y.1 = mean(dv.1, na.rm = T)), by = year]
y.2 <- rais.mun.did[index.lag == 0, .(y.2 = mean(dv.2, na.rm = T)), by = year]
y.3 <- rais.mun.did[index.lag == 0, .(y.3 = mean(dv.3, na.rm = T)), by = year]
y.4 <- rais.mun.did[index.lag == 0, .(y.4 = mean(dv.4, na.rm = T)), by = year]

##Merging by year
rais.mun.did <- merge(rais.mun.did, y.0, all.x = T, by = "year")
rais.mun.did <- merge(rais.mun.did, y.1, all.x = T, by = "year")
rais.mun.did <- merge(rais.mun.did, y.2, all.x = T, by = "year")
rais.mun.did <- merge(rais.mun.did, y.3, all.x = T, by = "year")
rais.mun.did <- merge(rais.mun.did, y.4, all.x = T, by = "year")
rm(y.0, y.1, y.2, y.3, y.4) #cleanup

##Shrinking data.table to country-years with transition to democracy
rais.mun.did.1 <- rais.mun.did[index.lag == 1]
rais.mun.did.1 <- rais.mun.did.1[,`:=` (tau.1 = (dv.1 - dv.0) - (y.1 - y.0))]
rais.mun.did.1 <- rais.mun.did.1[,`:=` (tau.2 = (dv.2 - dv.0) - (y.2 - y.0))]
rais.mun.did.1 <- rais.mun.did.1[,`:=` (tau.3 = (dv.3 - dv.0) - (y.3 - y.0))]
rais.mun.did.1 <- rais.mun.did.1[,`:=` (tau.4 = (dv.4 - dv.0) - (y.4 - y.0))]

##Computing tau.did
rais.mun.tau <- rais.mun.did.1[, .(year, mun_id, tau.1, tau.2, tau.3, tau.4)]
tau.did <- rais.mun.tau[, .(tau.1 = mean(tau.1, na.rm = T), tau.2 = mean(tau.2, na.rm = T), 
                          tau.3 = mean(tau.3, na.rm = T), tau.4 = mean(tau.4, na.rm = T))]

##Obtaining confidence intervals from bootstrap
cl <- makeCluster(3)
registerDoParallel(cl)
tau.bootstrap <- foreach(i = 1:100, .packages = c("data.table", "dplyr")) %dopar%{
df <- sample_n(data.mun, size = nrow(data.mun), replace = T) %>%
  as.data.table
rais.mun.did <- df[, .(mun_id, year,  dem = treat, dv.0 = mean.edu)]

##Indicator for transition to programmatic at time t
rais.mun.did <- rais.mun.did[, `:=` (lag.dem = shift(dem, 1, type = "lag")), by = mun_id]
rais.mun.did <- rais.mun.did[, `:=` (index.lag = dem - lag.dem)]

##Future variables for growth rate
rais.mun.did <- rais.mun.did[, `:=` (dv.1 = shift(dv.0, 1, type = 'lead'), dv.2 = shift(dv.0, 2, type = 'lead'),
                   dv.3 = shift(dv.0, 3, type = 'lead'), dv.4 = shift(dv.0, 4, type = 'lead'),
                   dv.5 = shift(dv.0, 5, type = 'lead'), dv.6 = shift(dv.0, 6, type = 'lead'))]

##Computing the average growth rate for non-treated at time t
y.0 <- rais.mun.did[index.lag == 0, .(y.0 = mean(dv.0, na.rm = T)), by = year]
y.1 <- rais.mun.did[index.lag == 0, .(y.1 = mean(dv.1, na.rm = T)), by = year]
y.2 <- rais.mun.did[index.lag == 0, .(y.2 = mean(dv.2, na.rm = T)), by = year]
y.3 <- rais.mun.did[index.lag == 0, .(y.3 = mean(dv.3, na.rm = T)), by = year]
y.4 <- rais.mun.did[index.lag == 0, .(y.4 = mean(dv.4, na.rm = T)), by = year]

##Merging by year
rais.mun.did <- merge(rais.mun.did, y.0, all.x = T, by = "year")
rais.mun.did <- merge(rais.mun.did, y.1, all.x = T, by = "year")
rais.mun.did <- merge(rais.mun.did, y.2, all.x = T, by = "year")
rais.mun.did <- merge(rais.mun.did, y.3, all.x = T, by = "year")
rais.mun.did <- merge(rais.mun.did, y.4, all.x = T, by = "year")
rm(y.0, y.1, y.2, y.3) #cleanup

##Shrinking data.table to country-years with transition to democracy
rais.mun.did.1 <- rais.mun.did[index.lag == 1]
rais.mun.did.1 <- rais.mun.did.1[,`:=` (tau.1 = (dv.1 - dv.0) - (y.1 - y.0))]
rais.mun.did.1 <- rais.mun.did.1[,`:=` (tau.2 = (dv.2 - dv.0) - (y.2 - y.0))]
rais.mun.did.1 <- rais.mun.did.1[,`:=` (tau.3 = (dv.3 - dv.0) - (y.3 - y.0))]

##COMPUTING THE TAU.DID!!! xD
rais.mun.tau <- rais.mun.did.1[, .(year, mun_id, tau.1, tau.2, tau.3)]
tau.did <- rais.mun.tau[, .(tau.1 = mean(tau.1, na.rm = T), tau.2 = mean(tau.2, na.rm = T), 
                          tau.3 = mean(tau.3, na.rm = T))]
tau.did
}
stopCluster(cl)

##Calculating the standard error
tau.bootstrap <- rbindlist(tau.bootstrap)
se.boot <- apply(tau.bootstrap, 2, sd)
mean.boot <- apply(tau.bootstrap, 2, mean)
bias.tau <- 2*tau.did - mean.boot

ci.low <- tau.did - qnorm(0.975)*se.boot
ci.high <- tau.did + qnorm(0.975)*se.boot

##Plotting point estimates with confidence intervals
plot(x = c(1:4), y = tau.did, xaxt = "n", xlab = "", ylab = "",
     pch = 15, col = "black", ylim = c(-0.5, 0.5))
abline(0,0, lty = "dashed")
title("Estimates of tau and 95% confidence intervals")
axis(1, at = c(1:4), labels = c("tau.0", "tau.1", "tau.2", "tau.3"))
lines(c(1,1), c(ci.low[[1]], ci.high[[1]]))
lines(c(2,2), c(ci.low[[2]], ci.high[[2]]))
lines(c(3,3), c(ci.low[[3]], ci.high[[3]]))
lines(c(4,4), c(ci.low[[4]], ci.high[[4]]))
```

As suspected from the random forest estimation results, the effect of programmatic partisanship seems quite low. This confirms the findings posited by Johannesen (2017) that the PT mayors do not seem to govern differently from non-PT ones. Rather, we must seek for answers from other theories of what is driving changes in local state capacity.
\pagebreak

#References

Bersch, Katherine, S?rgio Pra?a, and Matthew M. Taylor. "State Capacity, Bureaucratic Politicization, and Corruption in the Brazilian State." Governance 30.1 (2017): 105-124.

Carpenter, Daniel P. The forging of bureaucratic autonomy: Reputations, networks, and policy innovation in executive agencies, 1862-1928. Princeton University Press, 2001.

Centeno, Miguel Angel. "Blood and Debt: War and Taxation in Nineteenth-Century Latin America 1." American Journal of sociology 102.6 (1997): 1565-1605.

Coatsworth, John H. "Structures, endowments, and institutions in the economic history of Latin America." Latin American Research Review 40.3 (2005): 126-144.

Evans, Peter B. Embedded autonomy: States and industrial transformation. Princeton University Press, 2012.

Evans, Peter, and James E. Rauch. "Bureaucracy and growth: A cross-national analysis of the effects of" Weberian" state structures on economic growth." American sociological review (1999): 748-765.

Fukuyama, Francis. "What is governance?." Governance 26.3 (2013): 347-368.

IPEA. "Burocracia e Ocupa??o no Setor P?blico Brasileiro" (2011)

Kohli, Atul. State-directed development: political power and industrialization in the global periphery. Cambridge University Press, 2004.

Kurtz, Marcus J. Latin American state building in comparative perspective: Social foundations of institutional order. Cambridge University Press, 2013.

Love, Joseph. "Economic ideas and ideologies in Latin America since 1930." The Cambridge History of Latin America 6.1 (1994).

O'Donnell, Guillermo. "On the state, democratization and some conceptual problems: A Latin American view with glances at some postcommunist countries." World Development 21.8 (1993): 1355-1369.

Pessoa, Eneuton and Martins, Marcilene. "O emprego p?blico no Brasil, nos anos 90". (2003)

Skowronek, Stephen. Building a new American state: The expansion of national administrative capacities, 1877-1920. Cambridge University Press, 1982.

Soifer, Hillel David. State Building in Latin America. Cambridge University Press, 2015.

Soifer, Hillel, and Matthias Vom Hau. "Unpacking the strength of the state: The utility of state infrastructural power." Studies in Comparative International Development 43.3-4 (2008): 219-230.

[^1]: Coatsworth 2005, Kurtz 2013.
[^2]: Kohli 2004.
[^3]: O'Donnell 1993.
[^4]: Vom Haum and Soifer 2008, pp. 220.
[^5]: Kurtz 2013, pp.11; Centeno 1997.
[^6]: Kohli 2004, Evans 2012.
[^7]: Fukuyama 2013, pp. 354.
[^8]: Evans and Rauch 1999.
[^9]: Love 1994, pp. 402. Hirschmann 1968, pp. 4.
[^10]: O'Donnell 1979. 
[^11]: Pessoa 2003, pp. 255.
[^12]: O'Donnell 1993.
[^13]: Soifer 2015, Bersch et al. 2017.
[^14]: Arbache and Negri 2004, Ribeiro 2010.
[^15]: IPEA 2011, pp. 199.
[^16]: Skowronek 1982, Carpenter 2001.
[^17]: Johannesen 2017.